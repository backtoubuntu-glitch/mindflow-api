<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khensani AI - Your Learning Assistant | MindFlow AI</title>
    <meta name="description" content="Chat with Khensani AI - Your personal learning assistant with emotional intelligence and educational expertise.">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <style>
        .chat-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            height: calc(100vh - 80px);
        }

        .chat-sidebar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }

        .chat-main {
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            background: #f8fafc;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .ai-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 70%;
            padding: 1rem 1.25rem;
            border-radius: 18px;
            line-height: 1.5;
        }

        .message-user {
            align-self: flex-end;
            background: #3b82f6;
            color: white;
            border-bottom-right-radius: 6px;
        }

        .message-ai {
            align-self: flex-start;
            background: #f1f5f9;
            color: #374151;
            border-bottom-left-radius: 6px;
            border: 1px solid #e5e7eb;
        }

        .chat-input-container {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            background: #f8fafc;
        }

        .chat-input-form {
            display: flex;
            gap: 0.75rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 24px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .send-button {
            padding: 0.75rem 1.5rem;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        .send-button:hover {
            background: #2563eb;
        }

        .send-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .suggestion-chip {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 16px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion-chip:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .typing-indicator {
            display: none;
            padding: 1rem 1.25rem;
            background: #f1f5f9;
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            align-self: flex-start;
            color: #6b7280;
            font-style: italic;
        }

        .learning-context {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .chat-container {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .chat-sidebar {
                display: none;
            }

            .message {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Header -->
    <header class="main-header">
        <nav class="navbar">
            <div class="nav-brand">
                <a href="/index.html" class="logo-link">
                    <div class="logo" style="width: 40px; height: 40px; background: #2563eb; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">MF</div>
                    <span class="brand-text">MindFlow AI</span>
                </a>
            </div>
            
            <div class="nav-links">
                <a href="/index.html" class="nav-link">Home</a>
                <a href="/dashboard.html" class="nav-link">Dashboard</a>
                <a href="/khensani-platform.html" class="nav-link active">Khensani AI</a>
                <a href="/chess.html" class="nav-link">Educational Chess</a>
                <a href="/safety.html" class="nav-link">Safety</a>
                <a href="/login.html" class="nav-link" id="loginBtn">Login</a>
                <a href="#" class="nav-link" id="logoutBtn" style="display: none;">Logout</a>
            </div>
            
            <div class="nav-actions">
                <button id="voiceToggle" class="voice-btn">ðŸŽ¤ Voice</button>
                <span id="userWelcome" class="user-welcome" style="display: none;"></span>
            </div>
        </nav>
    </header>

    <!-- Khensani AI Chat Interface -->
    <div class="chat-container">
        <!-- Sidebar -->
        <div class="chat-sidebar">
            <h3 style="margin-bottom: 1rem; color: #374151;">Khensani AI</h3>
            <p style="color: #6b7280; margin-bottom: 1.5rem; line-height: 1.5;">
                Your personal learning assistant. I can help with homework, explain concepts, provide study tips, and make learning fun!
            </p>
            
            <div class="learning-context">
                <h4 style="margin-bottom: 0.5rem; color: #0369a1;">Learning Context</h4>
                <select id="subjectSelect" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; margin-bottom: 0.5rem;">
                    <option value="general">General Learning</option>
                    <option value="math">Mathematics</option>
                    <option value="science">Science</option>
                    <option value="language">Language Arts</option>
                    <option value="history">History</option>
                    <option value="programming">Programming</option>
                </select>
                <select id="gradeSelect" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                    <option value="elementary">Elementary School</option>
                    <option value="middle">Middle School</option>
                    <option value="high">High School</option>
                    <option value="college">College</option>
                </select>
            </div>

            <div style="margin-top: 1.5rem;">
                <h4 style="margin-bottom: 0.75rem; color: #374151;">Quick Actions</h4>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <button class="suggestion-chip" onclick="askQuestion('Can you help me with math homework?')">Math Help</button>
                    <button class="suggestion-chip" onclick="askQuestion('Explain photosynthesis simply')">Science Help</button>
                    <button class="suggestion-chip" onclick="askQuestion('Give me study tips for exams')">Study Tips</button>
                    <button class="suggestion-chip" onclick="askQuestion('Create a learning schedule for me')">Learning Plan</button>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-main">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="ai-avatar">ðŸ¤–</div>
                <div>
                    <h3 style="margin: 0; color: #374151;">Khensani AI</h3>
                    <p style="margin: 0; color: #6b7280; font-size: 0.875rem;">Online - Ready to help you learn!</p>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chatMessages">
                <!-- Welcome Message -->
                <div class="message message-ai">
                    <strong>Khensani AI:</strong> Hello! I'm Khensani, your AI learning assistant! ðŸ¤–<br><br>
                    I'm here to help you with homework, explain difficult concepts, provide study tips, and make learning fun and engaging. What would you like to learn about today?
                </div>

                <!-- Typing Indicator -->
                <div class="typing-indicator" id="typingIndicator">
                    Khensani is thinking...
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <form class="chat-input-form" id="chatForm">
                    <input type="text" class="chat-input" id="messageInput" placeholder="Ask me anything about learning..." required>
                    <button type="submit" class="send-button" id="sendButton">Send</button>
                </form>

                <!-- Quick Suggestions -->
                <div class="suggestion-chips">
                    <div class="suggestion-chip" onclick="askQuestion('Help me understand algebra')">Algebra Help</div>
                    <div class="suggestion-chip" onclick="askQuestion('What is the water cycle?')">Science Question</div>
                    <div class="suggestion-chip" onclick="askQuestion('How to improve my writing skills?')">Writing Tips</div>
                    <div class="suggestion-chip" onclick="askQuestion('Explain machine learning')">Tech Concepts</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/assets/js/encoding-fix.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/auth.js"></script>
    <script src="/assets/js/api.js"></script>
    <script src="/assets/js/voice.js"></script>
    
    <script>
        // Khensani AI Chat Logic
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const chatForm = document.getElementById('chatForm');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');

        // Focus input on load
        messageInput.focus();

        // Handle form submission
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await sendMessage();
        });

        // Quick question function
        async function askQuestion(question) {
            messageInput.value = question;
            await sendMessage();
        }

        // Send message to Khensani AI
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessage(message, 'user');
            messageInput.value = '';
            sendButton.disabled = true;

            // Show typing indicator
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                // Get learning context
                const subject = document.getElementById('subjectSelect').value;
                const grade = document.getElementById('gradeSelect').value;

                // Send to Khensani AI
                const response = await window.MindFlowAPI.chatWithKhensani(message);

                // Hide typing indicator
                typingIndicator.style.display = 'none';

                // Add AI response
                if (response && response.response) {
                    addMessage(response.response, 'ai');
                } else {
                    addMessage("I understand your question! As an AI learning assistant, I'm here to help explain concepts, provide examples, and guide your learning journey. What specific topic would you like me to help with?", 'ai');
                }

            } catch (error) {
                console.error('Chat error:', error);
                typingIndicator.style.display = 'none';
                addMessage("I'm having trouble connecting right now, but I'd love to help you learn! Please try again in a moment, or try asking about math, science, language arts, or study techniques.", 'ai');
            } finally {
                sendButton.disabled = false;
                messageInput.focus();
            }
        }

        // Add message to chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            
            if (sender === 'ai') {
                messageDiv.innerHTML = `<strong>Khensani AI:</strong> ${text}`;
            } else {
                messageDiv.innerHTML = `<strong>You:</strong> ${text}`;
            }

            chatMessages.insertBefore(messageDiv, typingIndicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Voice integration
        if (window.voiceAI) {
            window.voiceAI.setupVoiceCommands();
        }

        // Enter key to send (but allow Shift+Enter for new line)
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                chatForm.dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html>